# Prompt user for the hostname
$hostname = Read-Host -Prompt "Enter the desired hostname for the machine"

# List of applications to install using Chocolatey
$applicationsToInstall = @(
    "notepadplusplus"
)

# List of Built-in aspplicaiotns to remove
$appsToRemove = @(
    "Microsoft.549981C3F5F10",
    "Microsoft.XboxGamingOverlay",
    "Microsoft.XboxIdentityProvider",
    "Microsoft.XboxSpeechToTextOverlay",
    "Microsoft.YourPhone",
    "Microsoft.Office.OneNote",
    "Microsoft.3DBuilder"
)

# START DOING STUFF -----------------------------------

# Disable UAC
Disable-UAC

# Disable Windows Defender
Set-MpPreference -DisableRealtimeMonitoring $true

# Disable unnecessary services
Get-Service -Name "MapsBroker", "WbioSrvc", "WMPNetworkSvc", "wscsvc", "WSearch" | Stop-Service -Force
Get-Service -Name "MapsBroker", "WbioSrvc", "WMPNetworkSvc", "wscsvc", "WSearch" | Set-Service -StartupType Disabled

# Disable unnecessary scheduled tasks
Get-ScheduledTask -TaskPath "\Microsoft\Windows\*" | Disable-ScheduledTask -Confirm:$false

# Remove default apps 
foreach ($app in $appsToRemove) {
    Get-AppxPackage -AllUsers | Where-Object { $_.PackageFamilyName -eq $app } | Remove-AppxPackage -AllUsers
}

# Disable unnecessary Windows features
Disable-WindowsOptionalFeature -Online -FeatureName "Printing-XPSServices-Features", "Microsoft-Hyper-V-All", "Microsoft-Hyper-V-Tools-All", "Microsoft-Windows-Subsystem-Linux"

# Disable Unwanted Processes
Get-Process -Name "SearchUI" | Stop-Process -Force #disable Cortana

# Set system for best performance
$systemPropertiesRegPath = "HKCU:\Control Panel\Desktop"
Set-ItemProperty -Path $systemPropertiesRegPath -Name "HungAppTimeout" -Value 1000
Set-ItemProperty -Path $systemPropertiesRegPath -Name "WaitToKillAppTimeout" -Value 2000
Set-ItemProperty -Path $systemPropertiesRegPath -Name "MenuShowDelay" -Value 8
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\Windows Error Reporting" -Name "Disabled" -Value 1 #disable Windows error reporting
powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61 # Set Windows 11 performance power plan
powercfg -h off # disable hibernate to save diskspace

$autoRestartRegPath = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU"
New-Item -Path $autoRestartRegPath -Force # Disable automatic restarts after updates
Set-ItemProperty -Path $autoRestartRegPath -Name "NoAutoRebootWithLoggedOnUsers" -Value 1

# Set Windows Explorer settings
Set-WindowsExplorerOptions -EnableShowHiddenFilesFoldersDrives -EnableShowProtectedOSFiles -EnableShowFileExtensions -EnableShowFullPathInTitleBar -EnableOpenFileExplorerToQuickAccess 

# Set the computer name
Rename-Computer -NewName $hostname -Force -Restart

# Install Chocolatey if not already installed
if (-not (Get-Command choco -ErrorAction SilentlyContinue)) {
    Set-ExecutionPolicy Bypass -Scope Process -Force
    iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
}

# Install Windows Updates
Install-WindowsUpdate -Full

# Reboot the system after changes
Restart-Computer -Force

# Install applications using Chocolatey
foreach ($app in $applicationsToInstall) {
    choco install $app -y
}